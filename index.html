<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Drive Link Converter</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="DriveConverter">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    body { font-family: 'Inter', sans-serif; }
    textarea { resize: vertical; }
    .link-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .link-card:hover { transform: translateX(4px); }
    
    /* Prevent zoom on input focus for mobile */
    input, textarea, select {
      font-size: 16px !important;
    }
    
    /* Prevent double-tap zoom */
    * {
      touch-action: manipulation;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3); }
      50% { opacity: 1; transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }
    
    .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    .animate-slideIn { animation: slideIn 0.3s ease-out forwards; }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-bounceIn { animation: bounceIn 0.5s ease-out forwards; }
    
    .shimmer {
      background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    .btn-hover {
      position: relative;
      overflow: hidden;
    }
    
    .btn-hover::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn-hover:active::after {
      width: 300px;
      height: 300px;
    }
    
    .logo-icon {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen flex items-center justify-center py-6 px-3 sm:py-8 sm:px-4">
  <div class="w-full max-w-2xl mx-auto">
    <!-- Header with Theme Toggle -->
    <div class="flex items-center justify-between mb-4 sm:mb-6 animate-slideIn">
      <div class="flex items-center gap-2 sm:gap-3">
        <div class="w-9 h-9 sm:w-10 sm:h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-600/30 logo-icon">
          <i class="fas fa-cloud-arrow-down text-white text-base sm:text-lg"></i>
        </div>
        <h1 class="text-lg sm:text-xl font-bold text-white">Drive Link Converter</h1>
      </div>
      <button
        id="themeToggle"
        class="w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-slate-700/50 hover:bg-slate-600/50 flex items-center justify-center transition border border-slate-600/30 btn-hover"
        title="Toggle theme"
      >
        <i id="themeIcon" class="fas fa-sun text-yellow-400"></i>
      </button>
    </div>

    <!-- Card -->
    <div class="card bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-2xl border border-slate-700/50 p-4 sm:p-6 animate-fadeIn">
      
      <!-- Input Section -->
      <div class="mb-4 sm:mb-5">
        <label class="block text-xs sm:text-sm font-semibold text-slate-300 mb-2">
          <i class="fas fa-link mr-2 text-blue-400"></i>Paste Google Drive Links
        </label>
        <textarea
          id="inputLinks"
          rows="5"
          class="w-full px-3 py-2.5 sm:px-4 sm:py-3 border border-slate-600/50 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm font-mono bg-slate-900/50 text-slate-200 placeholder-slate-500"
          placeholder="https://drive.google.com/open?id=FILE_ID&usp=drive_copy"
        ></textarea>
      </div>

      <!-- Convert Button -->
      <div class="flex gap-2 sm:gap-3 mb-4 sm:mb-5 flex-col sm:flex-row">
        <button
          id="convertBtn"
          class="flex-1 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-semibold py-3 px-4 sm:py-3.5 sm:px-6 rounded-xl transition duration-200 shadow-lg shadow-blue-600/30 flex items-center justify-center gap-2 btn-hover text-sm sm:text-base"
        >
          <i class="fas fa-bolt animate-pulse"></i>
          <span>Convert Links</span>
        </button>
        <button
          id="clearBtn"
          class="sm:px-6 bg-slate-700/30 hover:bg-red-500/20 text-slate-400 hover:text-red-400 font-semibold py-3 px-4 sm:py-3.5 rounded-xl transition duration-200 border border-slate-600/30 hover:border-red-500/30 btn-hover text-sm sm:text-base"
          title="Clear all"
        >
          <i class="fas fa-trash"></i>
        </button>
      </div>

      <!-- Output Section -->
      <div class="mb-4 sm:mb-5">
        <label class="block text-xs sm:text-sm font-semibold text-slate-300 mb-2">
          <i class="fas fa-download mr-2 text-green-400"></i>Download Links
        </label>
        <div
          id="outputLinks"
          class="space-y-2 max-h-64 sm:max-h-72 overflow-y-auto pr-2 custom-scrollbar"
        >
          <p class="text-slate-500 text-xs sm:text-sm italic text-center py-4">
            <i class="fas fa-arrow-left mr-2"></i>Converted links will appear here...
          </p>
        </div>
      </div>

      <!-- Copy Button -->
      <button
        id="copyBtn"
        class="w-full bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 font-semibold py-3 px-4 sm:py-3.5 sm:px-6 rounded-xl transition duration-200 border border-slate-600/30 flex items-center justify-center gap-2 btn-hover text-sm sm:text-base"
      >
        <i class="fas fa-copy"></i>
        <span>Copy All</span>
      </button>

      <!-- Success Message -->
      <div id="successMsg" class="hidden mt-3 sm:mt-4 text-center animate-bounceIn">
        <span class="inline-flex items-center gap-2 bg-green-500/20 text-green-400 text-xs sm:text-sm font-medium py-2 px-3 sm:py-2 sm:px-4 rounded-lg border border-green-500/30">
          <i class="fas fa-check-circle"></i>
          <span>Copied to clipboard!</span>
        </span>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-slate-500 text-xs sm:text-sm mt-4 sm:mt-6 flex items-center justify-center gap-2 px-2">
      <i class="fas fa-info-circle"></i>
      <span>Paste multiple links, one per line</span>
    </footer>

    <!-- Copyright -->
    <div class="copyright text-center mt-4 sm:mt-6 text-slate-600 text-xs flex items-center justify-center gap-1 px-2">
      <span>Â© 2026 Crafted with</span>
      <i class="fas fa-heart text-red-500 animate-pulse"></i>
      <span>by Ayad E. Korial</span>
    </div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="hidden fixed bottom-3 left-1/2 transform -translate-x-1/2 bg-slate-800 border border-slate-600/50 rounded-xl shadow-2xl p-3 sm:p-4 w-[90%] max-w-sm flex items-center gap-2 sm:gap-3 animate-slideIn z-50">
      <div class="w-9 h-9 sm:w-10 sm:h-10 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
        <i class="fas fa-download text-white text-sm sm:text-base"></i>
      </div>
      <div class="flex-1 min-w-0">
        <p class="text-white font-semibold text-xs sm:text-sm truncate">Install App</p>
        <p class="text-slate-400 text-xs truncate">Get quick access to Drive Converter</p>
      </div>
      <button id="installBtn" class="bg-blue-600 hover:bg-blue-500 text-white font-semibold py-1.5 px-3 sm:py-2 sm:px-4 rounded-lg transition btn-hover text-xs sm:text-sm flex-shrink-0">
        Install
      </button>
      <button id="dismissInstall" class="text-slate-400 hover:text-slate-300 transition p-1.5 sm:p-2 flex-shrink-0" title="Dismiss">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <style>
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(51, 65, 85, 0.3); border-radius: 3px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.8); border-radius: 3px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(100, 116, 139, 1); }
  </style>

  <script>
    // DOM Elements
    const inputLinks = document.getElementById('inputLinks');
    const outputLinks = document.getElementById('outputLinks');
    const convertBtn = document.getElementById('convertBtn');
    const copyBtn = document.getElementById('copyBtn');
    const clearBtn = document.getElementById('clearBtn');
    const successMsg = document.getElementById('successMsg');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    // Theme Toggle
    const savedTheme = localStorage.getItem('theme');
    let isDark = savedTheme !== 'light';

    function applyTheme(dark) {
      if (dark) {
        document.body.className = 'bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen flex items-center justify-center py-6 px-3 sm:py-8 sm:px-4';
        document.querySelector('.card').className = 'card bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-2xl border border-slate-700/50 p-4 sm:p-6';
        document.querySelectorAll('label').forEach(el => {
          el.className = el.className.replace('text-gray-700', 'text-slate-300');
        });
        document.getElementById('inputLinks').className = 'w-full px-3 py-2.5 sm:px-4 sm:py-3 border border-slate-600/50 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm font-mono bg-slate-900/50 text-slate-200 placeholder-slate-500';
        document.getElementById('copyBtn').className = 'w-full bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 font-semibold py-3 px-4 sm:py-3.5 sm:px-6 rounded-xl transition duration-200 border border-slate-600/30 flex items-center justify-center gap-2 btn-hover text-sm sm:text-base';
        document.getElementById('successMsg').className = 'hidden mt-3 sm:mt-4 text-center animate-bounceIn';
        document.querySelector('footer').className = 'text-center text-slate-500 text-xs sm:text-sm mt-4 sm:mt-6 flex items-center justify-center gap-2 px-2';
        document.querySelector('.copyright').className = 'text-center mt-4 sm:mt-6 text-slate-600 text-xs flex items-center justify-center gap-1 px-2';
        document.getElementById('themeToggle').className = 'w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-slate-700/50 hover:bg-slate-600/50 flex items-center justify-center transition border border-slate-600/30 btn-hover';
        themeIcon.className = 'fas fa-sun text-yellow-400';
      } else {
        document.body.className = 'bg-gradient-to-br from-gray-100 via-gray-50 to-gray-100 min-h-screen flex items-center justify-center py-6 px-3 sm:py-8 sm:px-4';
        document.querySelector('.card').className = 'card bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 sm:p-6';
        document.querySelectorAll('label').forEach(el => {
          el.className = 'block text-xs sm:text-sm font-semibold text-gray-700 mb-2';
        });
        document.getElementById('inputLinks').className = 'w-full px-3 py-2.5 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm font-mono placeholder-gray-400';
        document.getElementById('copyBtn').className = 'w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-4 sm:py-3.5 sm:px-6 rounded-xl transition duration-200 border border-gray-200 flex items-center justify-center gap-2 btn-hover text-sm sm:text-base';
        document.getElementById('successMsg').className = 'hidden mt-3 sm:mt-4 text-center animate-bounceIn';
        document.querySelector('footer').className = 'text-center text-gray-500 text-xs sm:text-sm mt-4 sm:mt-6 flex items-center justify-center gap-2 px-2';
        document.querySelector('.copyright').className = 'text-center mt-4 sm:mt-6 text-gray-400 text-xs flex items-center justify-center gap-1 px-2';
        document.getElementById('themeToggle').className = 'w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition border border-gray-200 btn-hover';
        themeIcon.className = 'fas fa-moon text-slate-600';
      }
    }

    applyTheme(isDark);

    themeToggle.addEventListener('click', () => {
      isDark = !isDark;
      applyTheme(isDark);
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // Extract file ID from Google Drive link
    function extractFileId(url) {
      const regex = /id=([^&]+)/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }

    // Convert single link to download format
    function convertLink(url) {
      const fileId = extractFileId(url.trim());
      if (fileId) {
        return `https://drive.google.com/uc?export=download&id=${fileId}`;
      }
      return null;
    }

    // Convert all links
    function convertAllLinks() {
      const lines = inputLinks.value.split('\n').filter(line => line.trim());
      const convertedLinks = [];

      lines.forEach(line => {
        const converted = convertLink(line);
        if (converted) {
          convertedLinks.push(converted);
        }
      });

      // Render as numbered cards
      if (convertedLinks.length === 0) {
        outputLinks.innerHTML = '<p class="text-slate-500 text-sm italic text-center py-4"><i class="fas fa-arrow-left mr-2"></i>Converted links will appear here...</p>';
      } else {
        outputLinks.innerHTML = convertedLinks
          .map((link, index) => `
            <div class="link-card animate-fadeIn flex items-center gap-3 bg-slate-900/40 border border-slate-600/30 rounded-xl px-4 py-3" style="animation-delay: ${index * 0.05}s">
              <span class="flex items-center justify-center w-7 h-7 bg-blue-600/20 text-blue-400 font-bold text-xs rounded-lg shimmer">${index + 1}</span>
              <a href="${link}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm font-mono truncate flex-1 hover:underline">
                <i class="fas fa-external-link-alt mr-2 text-xs opacity-60"></i>${link}
              </a>
              <button onclick="copySingleLink('${link}')" class="text-slate-400 hover:text-slate-300 transition p-1 hover:scale-110" title="Copy link">
                <i class="fas fa-copy text-xs"></i>
              </button>
            </div>
          `)
          .join('');
      }
    }

    // Copy single link
    function copySingleLink(link) {
      navigator.clipboard.writeText(link);
      const btn = event.target.closest('button');
      const originalIcon = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-check text-green-400 animate-bounceIn"></i>';
      btn.classList.add('scale-110');
      setTimeout(() => {
        btn.innerHTML = originalIcon;
        btn.classList.remove('scale-110');
      }, 1500);
    }

    // Copy to clipboard
    async function copyToClipboard() {
      const links = outputLinks.querySelectorAll('a');
      if (links.length === 0) return;

      const textToCopy = Array.from(links).map(a => a.href).join('\n');

      try {
        await navigator.clipboard.writeText(textToCopy);
        successMsg.classList.remove('hidden');
        setTimeout(() => {
          successMsg.classList.add('hidden');
        }, 2000);
      } catch (err) {
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        successMsg.classList.remove('hidden');
        setTimeout(() => {
          successMsg.classList.add('hidden');
        }, 2000);
      }
    }

    // Event Listeners
    convertBtn.addEventListener('click', convertAllLinks);
    copyBtn.addEventListener('click', copyToClipboard);
    clearBtn.addEventListener('click', () => {
      inputLinks.value = '';
      outputLinks.innerHTML = '<p class="text-slate-500 text-sm italic text-center py-4"><i class="fas fa-arrow-left mr-2"></i>Converted links will appear here...</p>';
      successMsg.classList.add('hidden');
    });

    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('ServiceWorker registration successful:', registration.scope);
          })
          .catch((err) => {
            console.error('ServiceWorker registration failed:', err);
          });
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    const installPrompt = document.getElementById('installPrompt');
    const installBtn = document.getElementById('installBtn');
    const dismissInstall = document.getElementById('dismissInstall');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installPrompt.classList.remove('hidden');
    });

    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('User response to install prompt:', outcome);
        deferredPrompt = null;
        installPrompt.classList.add('hidden');
      }
    });

    dismissInstall.addEventListener('click', () => {
      installPrompt.classList.add('hidden');
    });

    window.addEventListener('appinstalled', () => {
      console.log('PWA installed successfully');
      installPrompt.classList.add('hidden');
      deferredPrompt = null;
    });
  </script>
</body>
</html>
